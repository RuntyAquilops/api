# Сервис для управления номерами отелей и бронированиями
Данный сервис представляет собой набор методов в виде HTTP-хендлеров с возвращаемым ответом в формате Json. 
* Язык программирования: php
* База данных: mySQL

# Требования для использования сервиса
1. Сервер (MAMP, Open Server, Denwer или любой другой)
2. phpMyAdmin
3. Установленный cURL или Postman

# Процесс запуска
1. Необходимо склонировать данный репозиторий в корневую папку сервера (обычно это htdocs, www...).
```
git clone https://github.com/RuntyAquilops/api.git hotel
```
Где hotel - название папки сервиса

2. Открыть phpMyAdmin и импортировать дамп базы данных (файл db_hotel.sql в данном репозитории).

![Импортирование базы данных](images/import_db.png)

Далее нажать кнопку Go.

3. Для подключения к базе данных нужно внести следующие изменения в файл connect.php:
```php
$host = 'localhost:3307'; // 3307 следует поменять на свой порт для mySQl
$userName = 'ваше имя пользователя phpmyadmin'; 
$userPassword = 'ваш пароль пользователя';
$database = 'hotel'; // название импортированной бд
```

4. Для проверки работы подключения можно перейти на http:localhost:/{название папки сервиса}/. Если вы видите надпись Welcome, то значит всё прошло хорошо.

# Примеры http запросов (cURL)

## Добавление номера отеля

Принимает на вход текстовое описание и цену за ночь. Возвращает ID номера отеля.

Запрос:
```
curl -X POST -d "number_room=13" -d "cost_per_night=1000" http://localhost/hotel/rooms/create
```

## Получение списка номеров отеля


```
curl -X GET -L http://localhost/hotel/rooms/
```

Также есть возможность сортировки по цене (cost_per_night) или дате добавления (data_create). Если написан '-' перед параметром, то значения сортируются по убыванию (DESC). Если ничего не указано перед параметром, то сортировка по возрастанию (ASC).

Пример сортировки по цене по убыванию:

```
curl -X GET -L http://localhost/hotel/rooms/sort=-cost_per_night
```

Пример сортировки по дате добавления по возрастанию:

```
curl -X GET -L http://localhost/hotel/rooms/sort=data_create
```

## Удаление номера и всех его броней

Принимает на вход ID номера отеля (в примере id номера отеля равно 6). Возвращает сообщение об удачном удалении или ошибку.

```
curl -X DELETE -L http://localhost/hotel/rooms/delete/6
```

## Добавление брони 
Принимает на вход существующий ID номера отеля, дату начала, дату окончания брони. Возвращает ID созданной брони.
```
curl -X POST -d "id_room=2" -d "start_data=2021-12-21" -d "end_data=2021-12-23" -L http://localhost/hotel/bookings/create/
```

## Получение списка броней номера отеля
Принимает на вход ID номера отеля. Возвращает список бронирований, каждое бронирование содержит ID брони, ID номера отеля, дату начала, дату окончания. Бронирования отсортированы по дате начала. 

```
curl -X GET -L http://localhost/hotel/bookings?id_room=2
```

## Удаление брони 
Принимает на вход ID брони (в примере ID равен 2). Возвращает сообщение об удачном удалении или ошибку.

```
curl -X DELETE -L http://localhost/hotel/bookings/delete/2
```

# Вопросы, которые возникли при работе
1. PDO или mySQLi? 

PDO показался мне немного сложным для довольно простого сервиса. Тем более я собиралась использовать только базу данных mySQL. В результате чего я выбрала mySQLi.

2. SQL-инъекции

Немаловажным фактом при работе с базой данных считаю вероятность использования SQL-инъекций. Поэтому немного покопавшись в Google, ~параллельно став хакером~, я как могла защитила sql запросы.

3. Docker

Моя нереализованная мечта. Довольно много времени потратила на изучение и создание Dockerfile и docker-compose.yml. В результате возникли проблемы с .htmlaccess и структурой проекта, который создался в контейнере. В итоге решила отбросить сборку проекта с помощью Docker до лучших времен. Но в данном Readme постаралась описать максимально просто, что надо сделать для развертывания сервиса.

# Контакты
По любым вопросам, ошибкам и замечаниям можете смело писать мне.

Телеграмм: https://t.me/RuntyAquilops

Почта: kate24kay@gmail.com
